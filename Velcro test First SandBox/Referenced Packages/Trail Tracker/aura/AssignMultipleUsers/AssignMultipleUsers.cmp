<aura:component controller="trailheadapp.TrailmixAssignmentController" implements="lightning:actionOverride,flexipage:availableForRecordHome,force:hasRecordId,flexipage:availableForAllPageTypes,force:lightningQuickActionWithoutHeader" access="global" >
    <aura:attribute name="searchResults" type="List" />
    <aura:attribute name="selectedUsers" type="List" />
    <aura:attribute name="keyword" type="String"/>
    <aura:attribute name="record" type="Object"/>    
    <aura:attribute name="dueDate" type="Date" />
    <aura:attribute name="loading" type="Boolean" default="false" />
    <aura:attribute name="showSearchUI" type="Boolean" default="true"/> 
    <aura:attribute name="showDateUI" type="Boolean" default="false"/>
    <force:recordData recordId="{!v.recordId}" layoutType="FULL" fields="Id,Name" mode="VIEW" targetFields="{!v.record}" />    

    <div>
        
        <header class="slds-modal__header">
            <h2 id="id-of-modalheader-h2" class="slds-text-heading_medium">Assign Users</h2>
            <p class="slds-m-top_x-small">Trailmix: {!v.record.Name}</p>
        </header>

        <aura:if isTrue="{!v.showDateUI}">

            <div class="slds-form--stacked slds-align_absolute-center slds-p-bottom_medium slds-p-top_large">
                Select an optional due date for the user(s) to complete the trailmix.
            </div> 

            <div class="slds-form--stacked slds-align_absolute-center">
                <lightning:input type="date" name="dueDate" required="false" value="{!v.dueDate}"  />
            </div> 

            <div class="spinnerHolder slds-is-relative">
                <aura:if isTrue="{!v.loading}">
                    <lightning:spinner alternativeText="Loading" />
                </aura:if>    
            </div>       

            <div style="height: 17.8rem; "></div>
            <footer class="slds-modal__footer">
                <lightning:button name="cancelBtn" class="slds-button slds-button--neutral" onclick="{!c.cancel}" label="Cancel" /> 
                <lightning:button name="submitBtn" class="slds-button slds-button--neutral" onclick="{!c.showSearch}" label="Back" />
                <lightning:button name="submitBtn" class="slds-button slds-button--brand" onclick="{!c.submit}" label="Submit" />
                               
            </footer>               
            
        </aura:if>

        <aura:if isTrue="{!v.showSearchUI}">
            
            <!-- start gray box -->
            <div class="slds-modal__content slds-grid slds-nowrap" id="modal-content-id-1">
                <div class="slds-col slds-grid slds-grid_vertical slds-nowrap">
                    <div class="slds-p-vertical_x-small slds-p-horizontal_large slds-shrink-none slds-theme_shade">
                        
                        <!-- start search box -->
                        <div class="slds-form-element">
                            <label class="slds-form-element__label slds-assistive-text" for="combobox-unique-id-10">Search</label>
                            <div class="slds-form-element__control">
                                <div class="slds-combobox_container">
                                    <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" aria-expanded="false" aria-haspopup="listbox" role="combobox">
                                        <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                            <lightning:input type="text" name="keyword" value="{!v.keyword}" placeholder="Search Users" onchange="{!c.search}"/>
                                            <span class="slds-icon_container slds-icon-utility-search slds-input__icon slds-input__icon_right">
                                                <lightning:icon iconName="utility:search" class="slds-m-top_x-small" size="xx-small" alternativeText="Search"  /> 
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>  
                        <!-- start search box -->              
                        
                        <!-- start pills -->      
                        <div class="slds-pill_container slds-pill_container_bare slds-grow">
                            <ul class="slds-listbox slds-listbox_horizontal" role="listbox" aria-label="Selected Options:" aria-orientation="horizontal">
                                <aura:iteration items="{!v.selectedUsers}" var="user">
                                <li class="slds-listbox-item" role="presentation">
                                    <lightning:pill label="{!user.Name}" name="{!user.Id}" onremove="{!c.removeUser}"/>
                                </li>
                                </aura:iteration>
                            </ul>
                        </div>
                        <!-- end pills -->                          
                    
                    </div>   
                </div>
            </div>
            <!-- end gray box -->
            
            <!-- start scrollable results box -->
            <div class="slds-scrollable slds-grow" style="height: 18.5rem; ">
                
                <table role="grid" class="slds-table slds-table_fixed-layout slds-table_bordered slds-table_resizable-cols slds-no-row-hover slds-scrollable_none">
                    <thead>
                        <tr class="slds-line-height_reset">
                            <th scope="col" style="width: 3rem;"></th>
                            <th aria-label="Name" aria-sort="none" class="slds-text-title_caps" scope="col" style="width: 3.2rem;">
                                <span class="slds-truncate slds-th__action" title="Name">Name</span>
                            </th>
                            <th aria-label="Name" aria-sort="none" class="slds-text-title_caps" scope="col">
                                <span class="slds-truncate slds-th__action" title="Name"></span>
                            </th>
                            <th aria-label="Name" aria-sort="none" class="slds-text-title_caps" scope="col">
                                <span class="slds-truncate slds-th__action" title="Title">Title</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>

                    <aura:iteration items="{!v.searchResults}" var="user">
                        <tr class="slds-hint-parent" aria-selected="true">
                            <td role="gridcell" tabindex="0" class="slds-text-align_right" style="width: 3.75rem;">
                                <lightning:buttonIcon name="{!user.Id}" iconName="utility:add" onclick="{!c.addUser}"  alternativeText="{!'Add ' + user.Name}" />
                            </td>
                            <th scope="row">
                                <lightning:avatar variant="circle" src="{!user.SmallPhotoUrl}" fallbackIconName="standard:person_account" alternativeText="{!user.Name}" class="slds-m-right_small"/>
                            </th>
                            <td role="gridcell">
                                <div class="slds-truncate" title="{!user.Name}">{!user.Name}</div>
                            </td>
                            <td role="gridcell">
                                <div class="slds-truncate" title="{!user.Title}">{!user.Title}</div>
                            </td>                            
                        </tr>
                    </aura:iteration>
                                                
                    </tbody>
                </table>
                
            </div>
            <!-- end scrollable results box -->

            <footer class="slds-modal__footer">
                <lightning:button name="cancelBtn" class="slds-button slds-button--neutral" onclick="{!c.cancel}" label="Cancel" /> 
                <lightning:button name="submitBtn" class="slds-button slds-button--brand" onclick="{!c.showDate}" label="Next" />            
            </footer>              

        </aura:if>
        
    </div>  
    
</aura:component>